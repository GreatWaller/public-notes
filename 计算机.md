# 计算机

### 1 计算机组成

![image-20200702092924104](C:\Users\Xuan\AppData\Roaming\Typora\typora-user-images\image-20200702092924104.png)

> 寄存器的速度为内存的100倍, 所以先存入cache

![image-20200702093321207](C:\Users\Xuan\AppData\Roaming\Typora\typora-user-images\image-20200702093321207.png)

> 缓存：往下起来越慢。L3多核共享。

![image-20200702143627480](C:\Users\Xuan\AppData\Roaming\Typora\typora-user-images\image-20200702143627480.png)

![image-20200702095041920](C:\Users\Xuan\AppData\Roaming\Typora\typora-user-images\image-20200702095041920.png)

- 超线程

 ![image-20200702093759917](C:\Users\Xuan\AppData\Roaming\Typora\typora-user-images\image-20200702093759917.png)



- 指令重排序



### 2 缓存

![image-20200703110928856](C:\Users\Xuan\AppData\Roaming\Typora\typora-user-images\image-20200703110928856.png)

![image-20200703111203702](C:\Users\Xuan\AppData\Roaming\Typora\typora-user-images\image-20200703111203702.png)

> 冲突不命中（conflict miss）

![image-20200703111634594](C:\Users\Xuan\AppData\Roaming\Typora\typora-user-images\image-20200703111634594.png)

> 术语

![image-20200703115624868](C:\Users\Xuan\AppData\Roaming\Typora\typora-user-images\image-20200703115624868.png)

> 一个真实的高速缓存层次结构的解剖

![image-20200703143012170](C:\Users\Xuan\AppData\Roaming\Typora\typora-user-images\image-20200703143012170.png)

![image-20200703143416719](C:\Users\Xuan\AppData\Roaming\Typora\typora-user-images\image-20200703143416719.png)

> **现在系统会折中使一个高速缓存块包含64个字节**

![image-20200703150657871](C:\Users\Xuan\AppData\Roaming\Typora\typora-user-images\image-20200703150657871.png)

#### 如何利用局部性

![image-20200703165033844](C:\Users\Xuan\AppData\Roaming\Typora\typora-user-images\image-20200703165033844.png)



### 3 虚拟内存

#### 3.1 物理和虚拟地址

计算机系统的主存被组织成一个由M个连续的字节大小的单元组成的数组。每字节都有一个唯一的物理地址。

> 物理寻址

![image-20200703171107631](C:\Users\Xuan\AppData\Roaming\Typora\typora-user-images\image-20200703171107631.png)

> 虚拟寻址：位于CPU上的内存管理单元（MMU）利用存放在主存中的查询表来动态翻译虚拟地址，该表的内容由操作系统管理。

![image-20200703171550850](C:\Users\Xuan\AppData\Roaming\Typora\typora-user-images\image-20200703171550850.png)

#### 3.2 地址空间

> ==虚拟地址空间==：一个线性地址空间 N=2^n^。现代系统通常支持32位或64位虚拟地址空间。相应地，系统还有一个==物理地址空间==:M=2^m^。

主存中的每个字节都有一个选自虚拟地址空间的虚拟地址和一个选自物理空间的物理地址。

#### 3.3 虚拟内存作为缓存的工具

和存储器层次结构中的其它缓存一样，磁盘上的数据被分割成块，缓存在主存中。VM系统通过将虚拟内存分割为==虚拟页==（Virtual Page, VP）的大小固定的块来进行传输。

> 虚拟页和物理页（PP）大小相同。

![image-20200703181202521](C:\Users\Xuan\AppData\Roaming\Typora\typora-user-images\image-20200703181202521.png)

##### 3.3.1 DRAM缓存的组织结构

磁盘要比DRAM慢10万倍，同时从磁盘的一个扇区读取第一个字节的时间开销比起读这个扇区中的连续字节要慢大约10万倍。因为如此大的不命中处罚和访问第一个字节的开销，虚拟页往往很大，通常中==4KB~2MB==。

DRAM缓存是==全相联==的，即任何虚拟页都可以放置在任命物理页中。操作系统对DRAM缓存使用了较复杂的替换算法。

> DRAM缓存采用==写回==。